<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>StateFS: Writing StateFS Providers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">StateFS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Writing StateFS Providers</div>  </div>
</div><!--header-->
<div class="contents">
<p><a class="el" href="group__writing__providers.html#intro">Introduction</a></p>
<p><a class="el" href="group__writing__providers.html#providers">Writing StateFS Providers</a></p>
<ul>
<li><a class="el" href="group__writing__providers.html#api">Provider API</a><ul>
<li><a class="el" href="group__writing__providers.html#iteration">Iterating Child Nodes</a></li>
<li><a class="el" href="group__writing__providers.html#property_access">Accessing Properties</a></li>
</ul>
</li>
<li><a class="el" href="group__writing__providers.html#loader">Loaders</a></li>
<li><a class="el" href="group__writing__providers.html#registration">Provider Registration</a></li>
<li><a class="el" href="group__writing__providers.html#provider_examples">Examples</a></li>
</ul>
<h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>StateFS is the syntetic filesystem to expose current system state provided by StateFS plugins as properties wrapped into namespaces.</p>
<p>Plugins are files (shared libraries etc.) be loaded by loaders - shared libraries, used to expose StateFS <a class="el" href="group__writing__providers.html#api">Provider API</a> API from providers. Native provider can expose this C <a class="el" href="group__writing__providers.html#api">Provider API</a> API itself.</p>
<h1><a class="anchor" id="providers"></a>
Writing StateFS Providers</h1>
<p>StateFS provider is a shared library exposing statefs_provider_get function. To appear in statefs directory tree it should be <a class="el" href="group__writing__providers.html#registration">Provider Registration</a> registered.</p>
<h2><a class="anchor" id="api"></a>
Provider API</h2>
<p>Statefs provider API is used by statefs server to access provider information tree and properties data.</p>
<p>Provider should define <a class="el" href="group__provider__api.html#ga8ab627c705ddcc5ad9e2eaf69ac3d571">statefs_provider_get()</a> function, it is used to get provider's root <a class="el" href="structstatefs__provider.html">statefs_provider</a> structure for the first time.</p>
<p>StateFS information tree consists of <a class="el" href="structstatefs__node.html">nodes</a>, node type is determined by <a class="el" href="structstatefs__node.html#a5d682ac0d45df512986b6761cbc719e8">statefs_node.type</a>. Each node has optional <a class="el" href="structstatefs__node.html#ad23103eb1ee1c866d4b2f24aa1652a59">metadata</a> (array). There is a single root node (<a class="el" href="structstatefs__provider.html">statefs_provider</a>), namespace nodes (<a class="el" href="structstatefs__namespace.html">statefs_namespace</a>) and property nodes (<a class="el" href="structstatefs__property.html">statefs_property</a>).</p>
<p>Many provider structures has pointer to optional release function called by server to release resources associated with this structure.</p>
<p>Root node and namespace nodes can have children nodes and are called branch nodes (<a class="el" href="structstatefs__branch.html">statefs_branch</a>). <a class="el" href="class_property.html">Property</a> nodes are tree leafs.</p>
<h3><a class="anchor" id="iteration"></a>
Iterating Child Nodes</h3>
<p><a class="el" href="class_server.html">Server</a> accesses child node by name using <a class="el" href="structstatefs__branch.html#aaf7da5ed9f26a10643ea571891ddc7be">statefs_branch.find()</a>. Iteration through all child nodes is performed by means of opaque iterator (implementation is provider specific) retrieved by means of <a class="el" href="structstatefs__branch.html#aa3a5355d662b0a04953ff97e6c61955a">statefs_branch.first()</a> and traversed by means of <a class="el" href="structstatefs__branch.html#a5d2d412d8b1aa53a08f94e6890202b9f">statefs_branch.next()</a>. Node itself is accessed by means of <a class="el" href="structstatefs__branch.html#ac683abc0e0bf5d94d044cdf6abdd4f6c">statefs_branch.get()</a>. End of iteration is determined by <a class="el" href="structstatefs__branch.html#ac683abc0e0bf5d94d044cdf6abdd4f6c">statefs_branch.get()</a> returning NULL. At the end server calls optional <a class="el" href="structstatefs__branch.html#a654adc8a005908d74d611f40223ed88d">statefs_branch.release()</a> to release resources allocated by iterator (if any).</p>
<p><a class="el" href="class_provider.html">Provider</a> should expect parent node will be released by server only after all child nodes are released.</p>
<div align="center">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"><area shape="poly" id="node1" href="structstatefs__branch.html" title="ENTER" alt="" coords="109,113,107,106,99,99,88,94,73,91,57,89,41,91,27,94,15,99,8,106,5,113,8,121,15,127,27,133,41,136,57,137,73,136,88,133,99,127,107,121"/><area shape="poly" id="edge1" href="structstatefs__branch.html#aa3a5355d662b0a04953ff97e6c61955a" title=".first()" alt="" coords="106,103,206,86,207,91,107,108"/><area shape="rect" id="edge1-label" href="structstatefs__branch.html#aa3a5355d662b0a04953ff97e6c61955a" title=".first()" alt="" coords="134,73,181,93"/><area shape="poly" id="node4" href="structstatefs__node.html" title="node : statefs_node" alt="" coords="722,129,717,122,702,115,678,110,649,107,616,105,583,107,554,110,530,115,515,122,510,129,515,137,530,143,554,149,583,152,616,153,649,152,678,149,702,143,717,137"/><area shape="poly" id="edge5" href="structstatefs__branch.html#aaf7da5ed9f26a10643ea571891ddc7be" title=".find(name)" alt="" coords="108,117,205,127,358,131,498,130,498,135,358,136,205,132,107,123"/><area shape="rect" id="edge5-label" href="structstatefs__branch.html#aaf7da5ed9f26a10643ea571891ddc7be" title=".find(name)" alt="" coords="255,109,342,129"/><area shape="poly" id="edge2" href="structstatefs__branch.html#a5d2d412d8b1aa53a08f94e6890202b9f" title=".next() [.get() != null]" alt="" coords="271,50,270,40,274,31,284,25,299,23,316,26,325,35,322,39,314,31,299,28,286,30,278,35,275,41,276,50"/><area shape="rect" id="edge2-label" href="structstatefs__branch.html#a5d2d412d8b1aa53a08f94e6890202b9f" title=".next() [.get() != null]" alt="" coords="219,5,379,25"/><area shape="poly" id="edge3" href="structstatefs__branch.html#a654adc8a005908d74d611f40223ed88d" title=".release()" alt="" coords="387,63,562,48,562,54,387,69"/><area shape="rect" id="edge3-label" href="structstatefs__branch.html#a654adc8a005908d74d611f40223ed88d" title=".release()" alt="" coords="417,39,485,59"/><area shape="poly" id="edge4" href="structstatefs__branch.html#ac683abc0e0bf5d94d044cdf6abdd4f6c" title=".get()" alt="" coords="376,84,519,110,518,115,375,89"/><area shape="rect" id="edge4-label" href="structstatefs__branch.html#ac683abc0e0bf5d94d044cdf6abdd4f6c" title=".get()" alt="" coords="431,76,471,96"/></map>
</div>
<h3><a class="anchor" id="property_access"></a>
Accessing Properties</h3>
<p>To access property data and attributes server uses api defined in <a class="el" href="structstatefs__provider.html#a7589ffc092dcefaca4e195013a544634">statefs_provider.io</a>. <a class="el" href="structstatefs__io.html">This API</a> is done in a way resembling file access API but differs from it in details. The main idea is to give provider a way to organize property access in the way most suitable for it. So, provider can use some framework or implement API in its own specific way.</p>
<div align="center">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
<map name="dot_inline_dotgraph_2.map" id="dot_inline_dotgraph_2.map"><area shape="poly" id="node1" href="structstatefs__property.html" title="property" alt="" coords="114,59,111,51,103,45,92,39,77,36,60,35,43,36,28,39,17,45,9,51,6,59,9,66,17,73,28,78,43,81,60,83,77,81,92,78,103,73,111,66"/><area shape="poly" id="edge1" href="structstatefs__io.html#afbe6362d616e8193a4061bd8d007ac1d" title=".getattr()" alt="" coords="106,44,138,37,233,25,308,22,382,27,478,37,551,48,551,53,477,43,382,32,308,27,233,30,139,43,107,49"/><area shape="rect" id="edge1-label" href="structstatefs__io.html#afbe6362d616e8193a4061bd8d007ac1d" title=".getattr()" alt="" coords="275,5,339,25"/><area shape="poly" id="edge2" href="structstatefs__io.html#a7c116ab0807c7123abfcbd865fdebff6" title=".size()" alt="" coords="114,56,549,56,549,61,114,61"/><area shape="rect" id="edge2-label" href="structstatefs__io.html#a7c116ab0807c7123abfcbd865fdebff6" title=".size()" alt="" coords="284,39,329,59"/><area shape="poly" id="edge3" href="structstatefs__io.html#ad26512b00a3c8a110bb52fddc4104d23" title=".open()" alt="" coords="96,75,140,95,222,120,220,125,138,100,93,80"/><area shape="rect" id="edge3-label" href="structstatefs__io.html#ad26512b00a3c8a110bb52fddc4104d23" title=".open()" alt="" coords="139,77,192,97"/><area shape="poly" id="edge4" href="structstatefs__io.html#a1958fc85975ebf1fdc504087f39cb7c4" title=".close()" alt="" coords="374,122,477,95,554,72,555,77,478,100,375,127"/><area shape="rect" id="edge4-label" href="structstatefs__io.html#a1958fc85975ebf1fdc504087f39cb7c4" title=".close()" alt="" coords="422,77,477,97"/><area shape="poly" id="edge5" href="structstatefs__io.html#ac255c8bf70d5736593f00a45ac915d93" title=".read()" alt="" coords="394,144,421,145,511,147,511,152,421,151,393,149"/><area shape="rect" id="edge5-label" href="structstatefs__io.html#ac255c8bf70d5736593f00a45ac915d93" title=".read()" alt="" coords="425,128,474,148"/><area shape="poly" id="edge6" href="structstatefs__io.html#a8dc76fe58dac81663c459a0a19d340dd" title=".write()" alt="" coords="367,156,422,172,520,198,519,203,421,177,365,161"/><area shape="rect" id="edge6-label" href="structstatefs__io.html#a8dc76fe58dac81663c459a0a19d340dd" title=".write()" alt="" coords="422,155,477,175"/></map>
</div>
<h2><a class="anchor" id="loader"></a>
Loaders</h2>
<p>Loaders are used (obvioulsy :)) to load providers. <a class="el" href="class_loader.html">Loader</a> can e.g. prepare required environment for some native code provider (shared library), e.g. Qt code frequently needs Qt event loop to be executed in the "main" application thread - thread where soem Qt code was executed for the first time, so "qt" loader creates required environment and load Qt-based provider properly. Also loader can just get some file to be interpreted and to expose StateFS <a class="el" href="group__writing__providers.html#api">Provider API</a> by itself etc. <a class="el" href="class_loader.html">Loader</a> API is deascribed <a class="el" href="group__loader__api.html">Loader API</a> here. Currently loader API is a C++ API but C API can be added easily. There is also default loader used in the case provider type is not specified. Default loader expects shared library exposing <a class="el" href="class_provider.html">Provider</a> <a class="el" href="group__writing__providers.html#api">Provider API</a> API and just loads it.</p>
<h2><a class="anchor" id="registration"></a>
Provider Registration</h2>
<p>Invoke</p>
<pre class="fragment"> $ statefs register &lt;path_to_provider_library&gt;</pre><p>This should be done once. Statefs performs introspection of the provider and saves this information in the configuration files used to create nodes associated with the provider on next statefs start w/o accessing provider library itself. This is done to avoid to load plugins before actual usage because it can take a time and statefs startup time should be minimal.</p>
<p>To unregister provider invoke</p>
<pre class="fragment"> $ statefs unregister &lt;path_to_provider_library&gt;</pre><p>Provider description is stored in human readable but easy to parse form of s-expression. It can be dumped using:</p>
<pre class="fragment"> $ statefs dump &lt;path_to_provider_library&gt;</pre><h2><a class="anchor" id="provider_examples"></a>
Examples</h2>
<ul>
<li>Very basic provider example (written in C) is described <a class="el" href="group__power__example.html">here</a>.</li>
</ul>
<ul>
<li>Example of provider using statefspp framework for applications written on C++ is described <a class="el" href="group__statefspp__example.html">here</a>. </li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 23 2013 16:56:38 for StateFS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
